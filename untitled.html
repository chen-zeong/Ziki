<!DOCTYPE html>
<html lang="zh-CN" class=""> <!-- 'dark' class will be toggled here -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>进度条</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // 为了防止 FOUC (无样式内容闪烁)，这段脚本需要放在 <head> 中
        // 它会立即根据 localStorage 或系统偏好设置主题
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.remove('dark')
        }
    </script>
</head>
<body class="bg-slate-100 dark:bg-[#1e1a24] transition-colors duration-300 flex items-center justify-center min-h-screen font-sans">

    <!-- 主题切换按钮 -->
    <button id="theme-toggle" class="absolute top-5 right-5 p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
        <svg id="theme-toggle-dark-icon" class="hidden h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
        <svg id="theme-toggle-light-icon" class="hidden h-6 w-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 5.05A1 1 0 003.636 6.464l.707.707a1 1 0 001.414-1.414l-.707-.707zM3 11a1 1 0 100-2H2a1 1 0 100 2h1zM6.464 16.364l-.707.707a1 1 0 001.414 1.414l.707-.707a1 1 0 00-1.414-1.414z"></path></svg>
    </button>

    <!-- 进度条容器 -->
    <div id="progress-container" class="relative w-full max-w-xs bg-slate-300 dark:bg-[#3a2d5c] rounded-full h-12 shadow-lg overflow-hidden cursor-pointer" title="点击重新开始">
        
        <!-- 内部进度条填充层 -->
        <div id="progress-bar" 
             class="h-full rounded-full transition-all duration-300 ease-linear bg-purple-500 dark:bg-[#6c52a1]"
             style="width: 0%;">
        </div>

        <!-- 进度文字容器 -->
        <div class="absolute inset-0 flex items-center justify-between px-5 text-base font-semibold text-slate-800 dark:text-[#d9c8f5] tracking-wide">
            <span id="progress-text">压缩中 0%</span>
            <span id="time-remaining" class="text-sm opacity-80"></span>
        </div>
    </div>

    <script>
        // --- DOM 元素 ---
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const timeRemainingEl = document.getElementById('time-remaining');
        const progressContainer = document.getElementById('progress-container');
        const themeToggleBtn = document.getElementById('theme-toggle');
        const darkIcon = document.getElementById('theme-toggle-dark-icon');
        const lightIcon = document.getElementById('theme-toggle-light-icon');

        // --- 进度条逻辑 ---
        let progress = 0;
        let intervalId = null;
        const updateInterval = 50; // 每 50 毫秒更新一次
        const totalSteps = 100;
        const totalDuration = updateInterval * totalSteps; // 总时长 5000ms

        function startProgress() {
            progress = 0;
            if (intervalId) clearInterval(intervalId);

            intervalId = setInterval(() => {
                if (progress >= 100) {
                    clearInterval(intervalId);
                    intervalId = null;
                    timeRemainingEl.textContent = ''; // 完成后清空时间
                    return;
                }
                
                progress += 1;
                
                // 更新进度条
                progressBar.style.width = progress + '%';
                progressText.textContent = `压缩中 ${progress}%`;

                // 更新剩余时间
                const timeElapsed = progress * updateInterval;
                const timeRemaining = Math.ceil((totalDuration - timeElapsed) / 1000);
                timeRemainingEl.textContent = `剩余 ${timeRemaining} 秒`;

            }, updateInterval);
        }

        progressContainer.addEventListener('click', startProgress);
        
        // --- 主题切换逻辑 ---
        function updateThemeIcons() {
            if (document.documentElement.classList.contains('dark')) {
                lightIcon.classList.remove('hidden');
                darkIcon.classList.add('hidden');
            } else {
                darkIcon.classList.remove('hidden');
                lightIcon.classList.add('hidden');
            }
        }

        themeToggleBtn.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            const isDarkMode = document.documentElement.classList.contains('dark');
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            updateThemeIcons();
        });

        // --- 初始化 ---
        window.onload = () => {
            startProgress();
            updateThemeIcons();
        };
    </script>

</body>
</html>
